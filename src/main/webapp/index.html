<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>layui</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="js/layui/css/layui.css" media="all">
		<style type="text/css">
			::-webkit-scrollbar {
				width: 5px;
				/*对垂直流动条有效*/
				height: 5px;
				/*对水平流动条有效*/
				display: none;
			}
		</style>
	</head>
	<body class="layui-layout-body">
		<div class="layui-layout layui-layout-admin">
			<div class="layui-header">
				<div class="layui-logo">layui 后台布局</div>
				<!-- 头部区域（可配合layui已有的水平导航） -->
				<ul class="layui-nav layui-layout-left">
					<li class="layui-nav-item"><a href="">控制台</a></li>
					<li class="layui-nav-item"><a href="">商品管理</a></li>
					<li class="layui-nav-item"><a href="">用户</a></li>
					<li class="layui-nav-item">
						<a href="javascript:;">其它系统</a>
						<dl class="layui-nav-child">
							<dd><a href="">邮件管理</a></dd>
							<dd><a href="">消息管理</a></dd>
							<dd><a href="">授权管理</a></dd>
						</dl>
					</li>
				</ul>
				<ul class="layui-nav layui-layout-right">
					<li class="layui-nav-item">
						<a href="javascript:;">
							<img src="http://t.cn/RCzsdCq" class="layui-nav-img">
							贤心
						</a>
						<dl class="layui-nav-child">
							<dd><a href="">基本资料</a></dd>
							<dd><a href="">安全设置</a></dd>
						</dl>
					</li>
					<li class="layui-nav-item"><a href="">退了</a></li>
				</ul>
			</div>

			<div class="layui-side layui-bg-black">
				<div class="layui-side-scroll">
					<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
					<ul class="layui-nav layui-nav-tree" lay-filter="test">
						<li class="layui-nav-item layui-nav-itemed">
							<a class="" href="javascript:;">所有商品</a>
							<dl class="layui-nav-child">
								<dd><a href="javascript:;">列表一</a></dd>
								<dd><a href="javascript:;">列表二</a></dd>
								<dd><a href="javascript:;">列表三</a></dd>
								<dd><a href="">超链接</a></dd>
							</dl>
						</li>
						<li class="layui-nav-item">
							<a href="javascript:;">微官网</a>
							<dl class="layui-nav-child">
								<dd><a href="page/index2.html" target="view">微官网编辑</a></dd>
								<dd><a href="javascript:;">历史模板</a></dd>
								<dd><a href="">超链接</a></dd>
							</dl>
						</li>
						<li class="layui-nav-item">
							<a href="javascript:;">会员中心</a>
							<dl class="layui-nav-child">
								<dd><a href="javascript:;" target="view">会员管理</a></dd>
								<dd><a href="javascript:;">近期报表</a></dd>
								<dd><a href="javascript:">充值记录</a></dd>
								<dd><a href="javascript:">充值优惠</a></dd>
							</dl>
						</li>
						<li class="layui-nav-item"><a href="">云市场</a></li>
						<li class="layui-nav-item"><a href="">发布商品</a></li>
					</ul>
				</div>
			</div>

			<div class="layui-body">
				<div style="width: 500px;height:844px;float: left;">
						<iframe id="view" name="view" style="width: 500px;height: 844px;padding: 50px;"
						 frameborder="0" src="page/index2.html">
				
						</iframe>
				</div>
				
				
				<!-- 提交网页,通过ajax上传网页代码生成新的HTML网页 -->
				<div style="float: left;padding: 100px;margin-top: 250px;">
					<button id="submitHTML" type="button" class="layui-btn layui-btn-radius">提交网页</button>
				</div>
				<!-- 点击提交后实现网页的预览效果 -->
				<div style="width: 411px;height:844px;float: left;">
					<div style="position: relative;">
						<img src="img/Sketch004.png" width="411px;" style="position:absolute;" />
						<iframe id="preview" name="preview" style="width: 363px;height: 730px;position: absolute;left:22px;top: 70px;border-bottom-left-radius: 35px;border-bottom-right-radius: 35px;border-bottom:solid 10px #000000;"
						 frameborder="0" src="page/index2.html">
				
						</iframe>
					</div>
				</div>
			</div>
			<p id="viewht" style="display: none;"></p>
		</div>


		<script src="js/layui/layui.js"></script>
		<script>
			//JavaScript代码区域
			layui.use('element', function() {
				var element = layui.element;

			});

			layui.use(['jquery', 'layer'], function() {
				var $ = layui.jquery,
					layer = layui.layer;

				//后面就跟你平时使用jQuery一样

				$("#submitHTML").click(function() {
					var obj = document.getElementById("view").contentWindow;
					var ifmObj = obj.document.getElementById("html").innerHTML;
					document.getElementById("viewht").innerHTML = ifmObj;
					$(".control").remove();
					var htmltext = $("#viewht").html();
					alert(htmltext);
					$.ajax({
						url : getRootPath()+"/createHTML",
						type : "post",
						data : {"htmltext":htmltext},
						datatype:"json",
						success : function(data) {
							var jsondata = JSON.parse(data);
							var indexPageUrl = getRootPath()+jsondata.url;
							$("#preview").attr("src",indexPageUrl);

							alert(jsondata.url);
							alert(jsondata.msg);
						}
					});
				})
				
				

			});


			var getRootPath = function() {
				// http://localhost:8083/uimcardprj/share/meun.jsp
				var curWwwPath = window.document.location.href;
				// uimcardprj/share/meun.jsp
				var pathName = window.document.location.pathname;
				var pos = curWwwPath.indexOf(pathName);
				// http://localhost:8083
				var localhostPaht = curWwwPath.substring(0, pos);
				// uimcardprj
				var projectName = pathName
						.substring(0, pathName.substr(1).indexOf('/') + 1);
				if (projectName == "/weixin" || projectName == "/admin"  || projectName == "/pc")
					projectName = "";
				return(localhostPaht + projectName);
			}
			
				
		</script>
	</body>
</html>
